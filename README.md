# Zest

Zest is a full-stack recipe management web app built with Next.js App Router, TypeScript, Tailwind, shadcn/ui components, Drizzle ORM, and Turso/libSQL.

It implements **Version 3: Recipe Management System** with:
- local auth (email/password + DB sessions)
- per-user recipe CRUD
- status tagging (`favorite`, `to_try`, `made_before`)
- server-side search/filtering
- multi-user read-only sharing (email and token link)
- Gemini AI recipe workflows

## Live URL
- Netlify URL (placeholder): `https://fabulous-jalebi-d7ffc0.netlify.app/`

## Tech Stack
- Next.js (App Router) + TypeScript
- TailwindCSS + shadcn/ui-style components + lucide-react + sonner
- Turso/libSQL via `@libsql/client`
- Drizzle ORM + SQL migrations
- Custom local auth (bcryptjs, DB sessions, httpOnly cookie)
- Gemini REST API (`GEMINI_API_KEY`, server-side only)
- Netlify deployment (`@netlify/plugin-nextjs`)

## Core Features

### 1) Recipe management
Create, edit, delete recipes with:
- name
- ingredients (structured rows: item, quantity, unit)
- instructions
- metadata (cuisine, prep/cook time, servings, tags, notes)
- status (`favorite`, `to_try`, `made_before`)

### 2) Search and filters
Server-side filtering in `GET /api/recipes` by:
- name (`q`)
- ingredient (`ingredient` matched against stored ingredients JSON)
- cuisine (`cuisine`)
- preparation time (`maxPrepTime`)
- status (`status`)

### 3) Multi-user sharing
- Share recipe read-only by email or generated link token.
- Recipient sees shared recipes in **Shared with me**.
- Sender manages/revokes shares in **My shares**.
- Revocation removes access immediately.
- Recipient can **Save a copy** into personal recipes.

### 4) AI-native workflows (Gemini)
- **Paste recipe -> structured recipe**: parse messy text into form fields.
- **Cook with what you have**: pantry-based suggestions using saved recipes context.
- **Adapt recipe**:
  - Make it healthier
  - Make it vegetarian
  - Scale to N servings
  - Returns draft update; user confirms before overwrite.

## Auth + Authorization Rules
- Users can CRUD only their own recipes.
- Shared users can read only explicitly shared recipes.
- Shared-link flow requires login in this implementation.
- `POST /api/shares/accept/[token]` binds link share to logged-in user when allowed.

## API Routes

### Auth
- `POST /api/auth/sign-up`
- `POST /api/auth/sign-in`
- `POST /api/auth/sign-out`
- `GET /api/me`
- `PATCH /api/me` (profile name update)

### Recipes
- `GET /api/recipes`
- `POST /api/recipes`
- `GET /api/recipes/[id]`
- `PATCH /api/recipes/[id]`
- `DELETE /api/recipes/[id]`

### Sharing
- `POST /api/shares`
- `GET /api/shares/received`
- `GET /api/shares/sent`
- `PATCH /api/shares/[id]/revoke`
- `POST /api/shares/accept/[token]`
- `GET /api/shared/[token]`

### AI
- `POST /api/ai/parse-recipe`
- `POST /api/ai/suggest-from-pantry`
- `POST /api/ai/adapt-recipe`

## Database Schema
Implemented with Drizzle and SQL migration:
- `users`
- `sessions`
- `recipes`
- `recipe_shares`

Migration file:
- `drizzle/0000_*.sql` (generated by Drizzle)

## Environment Variables
Create `.env` from `.env.example`:

```bash
DATABASE_URL="file:local.db"
GEMINI_API_KEY=""
APP_URL="http://localhost:3000"
```

Notes:
- For Turso, use your libSQL URL in `DATABASE_URL`.
- If your Turso setup needs a separate token, code also supports `TURSO_AUTH_TOKEN`.

## Local Setup

```bash
npm install
npm run db:migrate:local
npm run dev
```

Then open `http://localhost:3000`.

Optional demo seed:

```bash
npm run db:seed:local
```

Demo account after seeding:
- email: `demo@zest.app`
- password: `password123`

## Deployment (Netlify + Turso)

### 1) Create Turso DB
1. Create DB in Turso.
2. Get database URL and auth token.
3. Set `DATABASE_URL` (and optionally `TURSO_AUTH_TOKEN` if needed).

### 2) Apply migrations to production DB
Migrations run automatically during Netlify deploy via `build:netlify` (`db:migrate` then `build`).

If you want to pre-apply manually from local machine with production env vars:

```bash
npm run db:migrate
```

### 3) Deploy to Netlify
1. Push repository to GitHub.
2. In Netlify, **Add new site** from GitHub repo.
3. Build command: `npm run build:netlify`
4. Publish directory: handled by Next.js Netlify plugin.
5. Set environment variables in Netlify:
   - `DATABASE_URL`
   - `GEMINI_API_KEY`
   - `APP_URL` (your Netlify site URL)
6. Deploy.

`netlify.toml` is included with `@netlify/plugin-nextjs`.

## Fast Demo Script
1. Sign up with two users (A and B).
2. User A creates a recipe with status/tags.
3. User A tests search filters (name, ingredient, cuisine, max prep, status).
4. User A opens recipe detail and runs AI adapt actions.
5. User A shares recipe to User B email and via link token.
6. User B accepts link (`/shared/[token]`), sees recipe in Shared with me.
7. User B saves copy to own recipes.
8. User A revokes share from My shares and verify access is removed.

## Scripts
- `npm run dev`
- `npm run build`
- `npm run start`
- `npm run lint`
- `npm run db:migrate`
- `npm run db:seed`
- `npm run db:migrate:local` (loads `.env` + `.env.local`)
- `npm run db:seed:local` (loads `.env` + `.env.local`)
- `npm run db:generate`
- `npm run db:studio`
